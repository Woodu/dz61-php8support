# 📋 Week 15 团队任务清单

**周次**: Week 15 - 交互表单实现  
**日期范围**: 2026-02-21 ~ 2026-02-27  
**项目进度**: 80% → 90%  
**状态**: 🔄 进行中

---

## 🎯 Week 15 目标

实现所有交互式表单的前端 UI，让用户可以通过 Web 界面创建内容。

### 完成标准
- ✅ 新主题表单功能完整
- ✅ 回复表单功能完整
- ✅ BBCode 编辑器功能完整
- ✅ 附件上传 UI 功能完整
- ✅ 投票创建 UI 功能完整
- ✅ 支付 UI 功能完整

---

## 📅 Day 1 (2026-02-21): 新主题表单 - 模板完善

### 🎨 设计团队任务

#### Task D1.1: 审查现有模板并制定增强计划 (2小时)
**负责人**: 架构师  
**优先级**: 🔴 P0

**任务描述**:
审查现有的`new_thread.html.twig`模板，确定需要增强的功能。

**审查内容**:
1. 检查模板完整性
2. 对比Legacy系统功能
3. 确定缺失功能清单
4. 制定增强计划

**交付物**:
- `docs/week15-new-thread-template-review.md`

---

### 💻 开发团队任务

#### Task DEV1.1: 完善新主题表单模板 (6小时)
**负责人**: 前端开发  
**优先级**: 🔴 P0

**任务描述**:
完善`templates/post/new_thread.html.twig`模板，确保所有功能完整。**必须参考Legacy系统** `poketb.com/bbs/templates/default/post_newthread.htm`。

**Legacy参考**:
- 主题图标: Line 210-212 (`iconid` radio buttons + `$icons`)
- 投票功能: Line 131-144 (`expiration`, `polloptions`, `visiblepoll`, `multiplepoll`, `maxchoices`)
- 支付功能: Line 199-205 (`price` input)
- 高级选项: Line 173-215 (折叠区域，包含readperm、price、iconid)

**需要完善的功能**:
1. ✅ 主题标题输入框（已存在）
2. ❌ **主题图标选择**（必须添加，参考Legacy Line 210-212）
   - 图标radio buttons（icon1.gif ~ icon9.gif）
   - 默认选择"无图标"（iconid=0）
3. ✅ BBCode编辑器工具栏（已存在）
4. ⏳ 附件上传区域（需要增强，参考Legacy post_editor.htm Line 453-511）
5. ❌ **投票选项**（必须添加，参考Legacy Line 131-144）
   - 投票有效期输入（expiration）
   - 投票选项textarea（polloptions，每行一个选项）
   - 投票前可见checkbox（visiblepoll）
   - 允许多选checkbox（multiplepoll）
   - 最大选择数输入（maxchoices，多选时显示）
6. ❌ **支付设置**（必须添加，参考Legacy Line 199-205）
   - 价格输入框（price）
   - 价格说明文字
7. ✅ 预览功能（已存在）
8. ❌ **高级选项折叠区域**（需要添加，参考Legacy Line 173-215）
   - 阅读权限（readperm）
   - 价格设置（price，与支付设置合并）
   - 图标选择（iconid，与主题图标合并）

**修改文件**:
- `templates/post/new_thread.html.twig`

**验收标准**:
- [ ] 所有表单字段完整
- [ ] 主题图标选择功能正常（与Legacy一致）
- [ ] 投票选项功能正常（与Legacy一致）
- [ ] 支付设置显示正常（与Legacy一致）
- [ ] 高级选项折叠功能正常
- [ ] 功能与Legacy系统一致

---

#### Task DEV1.2: 创建BBCode编辑器JavaScript (3小时)
**负责人**: 前端开发  
**优先级**: 🔴 P0

**任务描述**:
创建`public/js/bbcode-editor.js`，实现BBCode工具栏功能。

**功能要求**:
1. BBCode标签插入（粗体、斜体、下划线、链接、图片、引用、代码）
2. 选中文本自动包裹
3. 快捷键支持（Ctrl+B, Ctrl+I等）
4. 表情符号插入器

**创建文件**:
- `public/js/bbcode-editor.js`

**验收标准**:
- [ ] 所有BBCode按钮功能正常
- [ ] 快捷键支持正常
- [ ] 选中文本包裹正常

---

### 🧪 测试团队任务

#### Task QA1.1: 新主题表单功能测试 (2小时)
**负责人**: QA工程师  
**优先级**: 🔴 P0

**测试内容**:
1. 表单字段验证
2. BBCode工具栏功能
3. 表单提交流程

**验收标准**:
- [ ] 所有测试用例通过
- [ ] 测试报告生成

---

### 📝 Review团队任务

#### Task REV1.1: 代码审查 - 新主题表单 (1小时)
**负责人**: 技术负责人  
**优先级**: 🔴 P0

**审查内容**:
1. 模板代码质量
2. JavaScript代码质量
3. 安全性检查（XSS防护）

**验收标准**:
- [ ] 代码审查通过
- [ ] 无安全问题

---

## 📅 Day 2 (2026-02-22): 新主题表单 - JavaScript增强

### 💻 开发团队任务

#### Task DEV2.1: 实现附件上传功能 (4小时)
**负责人**: 前端开发  
**优先级**: 🔴 P0

**任务描述**:
实现附件上传的JavaScript功能，包括拖拽上传和进度显示。

**功能要求**:
1. 拖拽上传支持
2. 文件选择支持
3. 上传进度显示
4. 文件预览（图片）
5. 文件删除功能

**创建文件**:
- `public/js/upload-zone.js`

**验收标准**:
- [ ] 拖拽上传功能正常
- [ ] 上传进度显示正常
- [ ] 文件预览正常

---

#### Task DEV2.2: 实现投票选项动态添加 (2小时)
**负责人**: 前端开发  
**优先级**: 🔴 P0

**任务描述**:
实现投票选项的动态添加和删除功能。

**功能要求**:
1. 显示/隐藏投票选项区域
2. 动态添加投票选项
3. 删除投票选项
4. 投票设置（多选、可见性）

**修改文件**:
- `templates/post/new_thread.html.twig`
- `public/js/new-thread.js`（新建或更新）

**验收标准**:
- [ ] 投票选项动态添加正常
- [ ] 投票设置功能正常

---

#### Task DEV2.3: 实现预览功能 (2小时)
**负责人**: 前端开发  
**优先级**: 🟡 P1

**任务描述**:
实现BBCode内容的实时预览功能。

**功能要求**:
1. 预览窗口显示
2. BBCode解析预览
3. 样式正确渲染

**创建文件**:
- `public/js/preview.js`（或集成到bbcode-editor.js）

**验收标准**:
- [ ] 预览功能正常
- [ ] BBCode正确解析

---

## 📅 Day 3 (2026-02-23): 回复表单

### 💻 开发团队任务

#### Task DEV3.1: 完善回复表单模板 (4小时)
**负责人**: 前端开发  
**优先级**: 🔴 P0

**任务描述**:
完善`templates/post/reply.html.twig`模板。**必须参考Legacy系统** `poketb.com/bbs/templates/default/post_newreply.htm`。

**Legacy参考**:
- 主题预览: Line 83-103 (`post_thread_review`，显示原主题内容)
- 回复选项: 通过post_editor.htm提供（parseurloff, smileyoff, bbcodeoff, emailnotify等）

**需要完善的功能**:
1. ✅ BBCode编辑器（已存在）
2. ⏳ 引用功能增强（需要完善，参考Legacy post_editor.htm）
3. ⏳ 快速回复框（需要添加）
4. ⏳ AJAX提交（需要实现）
5. ❌ **回复选项**（需要添加，参考Legacy post_editor.htm Line 93-115）
   - 禁用URL解析（parseurloff）
   - 禁用表情（smileyoff）
   - 禁用BBCode（bbcodeoff）
   - 显示签名（usesig）
   - 邮件通知（emailnotify）
6. ✅ 主题预览（已存在，但需要验证完整性）

**修改文件**:
- `templates/post/reply.html.twig`

**验收标准**:
- [ ] 回复表单功能完整
- [ ] 引用功能正常

---

#### Task DEV3.2: 实现引用功能 (2小时)
**负责人**: 前端开发  
**优先级**: 🔴 P0

**任务描述**:
实现点击"引用"按钮时自动生成引用BBCode。

**功能要求**:
1. 获取被引用帖子内容
2. 生成引用BBCode格式
3. 插入到编辑器

**创建文件**:
- `public/js/reply-thread.js`

**验收标准**:
- [ ] 引用功能正常
- [ ] BBCode格式正确

---

#### Task DEV3.3: 实现AJAX表单提交 (3小时)
**负责人**: 前端开发  
**优先级**: 🔴 P0

**任务描述**:
实现回复表单的AJAX提交，无需刷新页面。

**功能要求**:
1. AJAX请求发送
2. 成功/失败处理
3. 错误提示显示
4. 成功后跳转或更新页面

**修改文件**:
- `public/js/reply-thread.js`

**验收标准**:
- [ ] AJAX提交正常
- [ ] 错误处理正常
- [ ] 用户体验良好

---

## 📅 Day 4 (2026-02-24): BBCode编辑器增强

### 💻 开发团队任务

#### Task DEV4.1: 实现实时预览 (3小时)
**负责人**: 前端开发  
**优先级**: 🟡 P1

**任务描述**:
实现BBCode编辑器的实时预览功能。

**功能要求**:
1. 输入时自动预览
2. 预览窗口切换
3. 预览内容正确渲染

**修改文件**:
- `public/js/bbcode-editor.js`

**验收标准**:
- [ ] 实时预览功能正常
- [ ] 性能良好（防抖处理）

---

#### Task DEV4.2: 实现自动保存草稿 (2小时)
**负责人**: 前端开发  
**优先级**: 🟡 P1

**任务描述**:
实现自动保存草稿到localStorage。

**功能要求**:
1. 定时保存（1秒延迟）
2. 恢复草稿提示
3. 清除草稿功能

**修改文件**:
- `public/js/bbcode-editor.js`

**验收标准**:
- [ ] 自动保存功能正常
- [ ] 草稿恢复正常

---

#### Task DEV4.3: 实现表情符号插入器 (3小时)
**负责人**: 前端开发  
**优先级**: 🟡 P1

**任务描述**:
实现表情符号选择器，点击插入到编辑器。

**功能要求**:
1. 表情符号列表加载
2. 表情选择器UI
3. 插入到编辑器

**创建文件**:
- `public/js/smilies.js`

**验收标准**:
- [ ] 表情符号插入正常
- [ ] UI友好

---

## 📅 Day 5 (2026-02-25): 附件上传UI增强

### 💻 开发团队任务

#### Task DEV5.1: 完善附件上传组件 (4小时)
**负责人**: 前端开发  
**优先级**: 🔴 P0

**任务描述**:
完善附件上传组件，包括拖拽上传、进度显示、文件预览等。

**功能要求**:
1. 拖拽上传区域
2. 文件列表显示
3. 上传进度条
4. 图片预览
5. 文件删除

**修改文件**:
- `public/js/upload-zone.js`
- `templates/post/new_thread.html.twig`
- `templates/post/reply.html.twig`

**验收标准**:
- [ ] 所有上传功能正常
- [ ] UI友好
- [ ] 移动端兼容

---

#### Task DEV5.2: 实现图片粘贴上传 (2小时)
**负责人**: 前端开发  
**优先级**: 🟡 P1

**任务描述**:
实现从剪贴板粘贴图片并自动上传。

**功能要求**:
1. 监听粘贴事件
2. 检测图片数据
3. 自动上传
4. 插入BBCode

**创建文件**:
- `public/js/paste-upload.js`

**验收标准**:
- [ ] 粘贴上传功能正常
- [ ] 自动插入BBCode

---

## 📅 Day 6 (2026-02-26): 投票和支付UI

### 💻 开发团队任务

#### Task DEV6.1: 实现投票UI (4小时)
**负责人**: 前端开发  
**优先级**: 🔴 P0

**任务描述**:
实现投票创建和显示的UI。

**功能要求**:
1. 投票选项输入
2. 投票结果显示
3. 投票提交
4. 投票结果统计

**修改文件**:
- `templates/post/new_thread.html.twig`
- `templates/poll/vote.html.twig`
- `templates/poll/results.html.twig`
- `public/js/poll.js`（新建）

**验收标准**:
- [ ] 投票创建UI正常
- [ ] 投票显示UI正常
- [ ] 投票提交正常

---

#### Task DEV6.2: 实现支付UI (4小时)
**负责人**: 前端开发  
**优先级**: 🔴 P0

**任务描述**:
实现支付页面的UI。

**功能要求**:
1. 支付信息显示
2. 支付表单
3. 支付确认
4. 支付结果页面

**修改文件**:
- `templates/payment/show.html.twig`
- `public/js/payment.js`（新建）

**验收标准**:
- [ ] 支付UI正常
- [ ] 支付流程完整

---

## 📅 Day 7 (2026-02-27): Week 15 验收与总结

### 🧪 测试团队任务

#### Task QA7.1: Week 15 功能验收 (4小时)
**负责人**: QA工程师  
**优先级**: 🔴 P0

**测试内容**:
1. 新主题表单完整流程
2. 回复表单完整流程
3. BBCode编辑器功能
4. 附件上传功能
5. 投票功能
6. 支付功能

**验收标准**:
- [ ] 所有功能测试通过
- [ ] 测试报告生成

---

### 📝 Review团队任务

#### Task REV7.1: Week 15 代码审查 (2小时)
**负责人**: 技术负责人  
**优先级**: 🔴 P0

**审查内容**:
1. 所有新增代码
2. 代码质量
3. 安全性检查
4. 性能评估

**验收标准**:
- [ ] 代码审查通过
- [ ] 无安全问题

---

### 📊 项目管理任务

#### Task PM7.1: Week 15 总结报告 (2小时)
**负责人**: 项目经理  
**优先级**: 🔴 P0

**任务描述**:
生成Week 15完成报告。

**交付物**:
- `WEEK15-COMPLETE.md`
- `WEEK15-SUMMARY.md`

---

## 📊 Week 15 进度跟踪

### 任务完成情况

| 任务 | 状态 | 完成度 |
|------|------|--------|
| Day 1: 新主题表单模板完善 | ⏳ | 0% |
| Day 2: JavaScript增强 | ⏳ | 0% |
| Day 3: 回复表单 | ⏳ | 0% |
| Day 4: BBCode编辑器增强 | ⏳ | 0% |
| Day 5: 附件上传UI | ⏳ | 0% |
| Day 6: 投票和支付UI | ⏳ | 0% |
| Day 7: 验收与总结 | ⏳ | 0% |

### 总体进度
- **Week 15前**: 80%
- **Week 15目标**: 90%
- **当前进度**: 0%

---

## 🎯 关键里程碑

| 日期 | 里程碑 | 预期完成度 |
|------|--------|-----------|
| 2026-02-21 | Day 1完成 | 82% |
| 2026-02-23 | Day 3完成 | 85% |
| 2026-02-25 | Day 5完成 | 87% |
| 2026-02-27 | Week 15完成 | 90% |

---

**文档生成时间**: 2026-02-21  
**文档状态**: ✅ Week 15任务清单已生成  
**下一步**: 开始执行Day 1任务
